{"version":3,"sources":["../../src/pollingSet.ts","../../src/ChildProcessTracker.ts","../../src/TimeoutUtils.ts","../../src/ChildProcess.ts","../../src/AsyncQueue.ts","../../src/index.ts"],"names":["promisify","execFile","os","crossSpawn","process"],"mappings":"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","file":"index.js","sourcesContent":["export class PollingSet<T> extends Set<T> {\n  public pollTimer?: NodeJS.Timeout;\n\n  public constructor(\n    private readonly interval: number,\n    private readonly action: () => void,\n  ) {\n    super();\n  }\n\n  public isActive(): boolean {\n    return this.size !== 0;\n  }\n\n  public hasTimer(): boolean {\n    return this.pollTimer !== undefined;\n  }\n\n  public clearTimer(): void {\n    if (!this.isActive() && this.hasTimer()) {\n      clearInterval(this.pollTimer);\n      this.pollTimer = undefined;\n    }\n  }\n\n  private poll() {\n    this.action();\n    if (!this.isActive()) {\n      this.clearTimer();\n    }\n  }\n\n  public override add(id: T) {\n    super.add(id);\n    this.pollTimer = this.pollTimer ?? setInterval(() => this.poll(), this.interval);\n    return this;\n  }\n\n  public override clear(): void {\n    this.clearTimer();\n    super.clear();\n  }\n}\n","import os from 'os';\nimport { promisify } from 'util';\nimport { execFile, ExecFileSyncOptionsWithStringEncoding } from 'child_process';\n\nimport { PollingSet } from './pollingSet';\nimport { ChildProcess } from './ChildProcess';\nimport { ProcessStats } from './interface/Process';\n\nconst MONITOR_INTERVAL = 5000; // In ms\nconst WIN_RETRY_WAIT_INTERVAL = 5000; // In ms\nconst execFileAsync = promisify(execFile);\n\nexport class ChildProcessTracker {\n  static readonly pollingInterval: number = 10000; // Check usage every 10 seconds\n  static readonly restartInterval: number = 10000; // Restart after 10 seconds once the threshold value stabilizes\n  static readonly thresholds: ProcessStats = {\n    memory: 300 * 1024 * 1024, // 300 MB\n    cpu: 70,\n  };\n  static readonly thresholdBuffer: ProcessStats = {\n    memory: 50 * 1024 * 1024, // 50 MB\n    cpu: 30,\n  };\n  #processByPid: Map<number, ChildProcess> = new Map<number, ChildProcess>();\n  #pids: PollingSet<number>;\n  #scheduledForDeletion: Set<number> = new Set();\n  #retryCount: number = 0;\n\n  public constructor() {\n    this.#pids = new PollingSet(ChildProcessTracker.pollingInterval, () => this.monitor());\n  }\n\n  private cleanUp() {\n    const terminatedProcesses = Array.from(this.#pids.values()).filter(\n      (pid: number) => this.#processByPid.get(pid)?.stopped,\n    );\n    for (const pid of terminatedProcesses) {\n      this.delete(pid);\n    }\n  }\n\n  private async monitor() {\n    this.cleanUp();\n    // console.debug(`Active running processes size: ${this.#pids.size}`);\n\n    for (const pid of this.#pids.values()) {\n      await this.checkProcessUsage(pid);\n    }\n  }\n\n  private async checkProcessUsage(pid: number): Promise<void> {\n    if (!this.#pids.has(pid) || this.#scheduledForDeletion.has(pid)) {\n      // console.log(`Missing process with id ${pid}`);\n      return;\n    }\n    const stats = await this.getUsage(pid);\n    if (stats) {\n      // console.debug(`Process ${pid} usage: %O`, stats);\n\n      if (stats.memory > ChildProcessTracker.thresholds.memory) {\n        console.log(`Process ${pid} exceeded memory threshold: ${stats.memory}`);\n        this.#scheduledForDeletion.add(pid);\n        await this.ensureSafeResourceUsage(pid);\n        return;\n      }\n      if (stats.cpu > ChildProcessTracker.thresholds.cpu) {\n        console.log(`Process ${pid} exceeded CPU threshold: ${stats.cpu}`);\n        if (this.isWin()) {\n          // Deleting process only for windows, others it will paused and resumed\n          this.#scheduledForDeletion.add(pid);\n        }\n        await this.ensureSafeResourceUsage(pid);\n        return;\n      }\n    }\n  }\n\n  private isWin() {\n    return process.platform === 'win32';\n  }\n\n  private async ensureSafeResourceUsage(pid: number): Promise<void> {\n    let runningProcess: ChildProcess | undefined;\n    const cycleStep = (this.#retryCount % 3) + 1;\n    await new Promise((resolve) => setTimeout(resolve, cycleStep * MONITOR_INTERVAL)); // Check every 5s exponentially increases till 15s\n    const stats = await this.getUsage(pid);\n    // console.debug(`Process ${pid} usage: %O`, stats);\n\n    if (stats.cpu === 0 && stats.memory === 0) {\n      // console.log(`Process ${pid} cpu and memory are 0 during monitoring.`);\n      return;\n    }\n\n    for (const childProcess of this.#processByPid.values()) {\n      if (pid === childProcess.pid()) {\n        runningProcess = childProcess;\n      }\n    }\n\n    const withinMemory =\n      stats.memory < ChildProcessTracker.thresholds.memory - ChildProcessTracker.thresholdBuffer.memory;\n    const withinCpu = stats.cpu < ChildProcessTracker.thresholds.cpu - ChildProcessTracker.thresholdBuffer.cpu;\n\n    if (withinCpu && withinMemory) {\n      // console.log(`Process ${pid} is within CPU threshold: ${stats.cpu} and Memory threshold: ${stats.memory}`);\n      if (!this.isWin()) {\n        runningProcess?.resume();\n      }\n      return;\n    }\n\n    if (!withinMemory) {\n      this.clear(pid);\n      // console.log(`Process ${pid} exceed Memory: ${stats.memory}, restarting process`);\n      this.#retryCount = this.#retryCount + 1;\n      await runningProcess?.restart(this.#retryCount);\n      return;\n    }\n\n    if (!withinCpu) {\n      if (this.isWin()) {\n        this.clear(pid);\n        // console.log(`Process ${pid} exceed CPU threshold: ${stats.cpu}, restarting process`);\n        await new Promise((r) => setTimeout(r, WIN_RETRY_WAIT_INTERVAL));\n        this.#retryCount = this.#retryCount + 1;\n        await runningProcess?.restart(this.#retryCount);\n        return;\n      }\n\n      // console.log(`Process ${pid} exceed CPU threshold: ${stats.cpu}, pausing process`);\n      runningProcess?.pause();\n      return;\n    }\n  }\n\n  public add(childProcess: ChildProcess) {\n    const pid = childProcess.pid();\n    this.#processByPid.set(pid, childProcess);\n    this.#pids.add(pid);\n  }\n\n  public delete(childProcessId: number) {\n    this.#processByPid.delete(childProcessId);\n    this.#pids.delete(childProcessId);\n  }\n\n  public get size() {\n    return this.#pids.size;\n  }\n\n  public has(childProcess: ChildProcess) {\n    return this.#pids.has(childProcess.pid());\n  }\n\n  public clear(pid: number) {\n    // Since the process is stopped gracefully, before stopping running process another process starts,\n    // So kill only specific process instead of killing all running process.\n    for (const childProcess of this.#processByPid.values()) {\n      if (childProcess.pid() == pid) {\n        this.#pids.delete(pid);\n        this.#processByPid.delete(pid);\n        childProcess.stop(true);\n      }\n    }\n    // this.#pids.clear();\n    // this.#processByPid.clear();\n  }\n\n  public async getUsage(pid: number): Promise<ProcessStats> {\n    try {\n      let memUsage: number;\n      let cpuUsage: number;\n\n      if (this.isWin()) {\n        // If the memory usage is 0, then the CPU usage is obviously 0.\n        memUsage = await this.getWinMemUsage(pid);\n        cpuUsage = memUsage === 0 ? 0 : await this.getWinCpuUsage(pid);\n      } else {\n        memUsage = await this.getUnixMemUsage(pid);\n        cpuUsage = memUsage === 0 ? 0 : await this.getUnixCpuUsage(pid);\n      }\n\n      return {\n        cpu: isNaN(cpuUsage) ? 0 : cpuUsage,\n        memory: isNaN(memUsage) ? 0 : memUsage,\n      };\n    } catch (e) {\n      return { cpu: 0, memory: 0 };\n    }\n  }\n\n  private async getWinMemUsage(pid: number): Promise<number> {\n    const execOptions: ExecFileSyncOptionsWithStringEncoding = {\n      stdio: ['pipe', 'pipe', 'ignore'], // suppress stderr such as 'No instance available'\n      encoding: 'utf8',\n    };\n    // execFileSync blocks the Node event loop\n    // While blocked, VS Code can’t process other tasks → the extension host becomes unresponsive.\n    // We check usage inside a PollingSet which runs every 5–10 seconds for each child process.\n    // So if we have multiple processes, we block the event loop N times in a row.\n    // TO avoid this, use async child processes instead. child_process.execFile is non-blocking.\n    const { stdout: memOutput } = await execFileAsync(\n      'wmic',\n      ['process', 'where', `ProcessId=${pid}`, 'get', 'WorkingSetSize'],\n      execOptions,\n    );\n    const memoryBytes = parseInt(memOutput.split('\\n')[1]);\n\n    return isNaN(memoryBytes) ? 0 : memoryBytes;\n  }\n\n  private async getWinCpuUsage(pid: number): Promise<number> {\n    const cpuCount = os.cpus().length;\n    const execOptions: ExecFileSyncOptionsWithStringEncoding = {\n      stdio: ['pipe', 'pipe', 'ignore'],\n      encoding: 'utf8',\n    };\n    const { stdout: cpuOutput } = await execFileAsync(\n      'wmic',\n      ['path', 'Win32_PerfFormattedData_PerfProc_Process', 'where', `IDProcess=${pid}`, 'get', 'PercentProcessorTime'],\n      execOptions,\n    );\n    const cpuPercentage = parseFloat(cpuOutput.split('\\n')[1]);\n\n    return isNaN(cpuPercentage) ? 0 : cpuPercentage / cpuCount;\n  }\n\n  private async getUnixMemUsage(pid: number): Promise<number> {\n    const { stdout: rssOutput } = await execFileAsync('ps', ['-p', pid.toString(), '-o', 'rss']);\n\n    return parseInt(rssOutput.split('\\n')[1]) * 1024;\n  }\n\n  private async getUnixCpuUsage(pid: number): Promise<number> {\n    const cpuCount = os.cpus().length;\n    const { stdout: cpuMemOutput } = await execFileAsync('ps', ['-p', pid.toString(), '-o', '%cpu,%mem']);\n    const cpuMemLines = cpuMemOutput.split('\\n')[1].trim().split(/\\s+/);\n    const cpuPercentage = parseFloat(cpuMemLines[0]);\n\n    return isNaN(cpuPercentage) ? 0 : cpuPercentage / cpuCount;\n  }\n}\n","import { WaitUntilOptions } from './interface/Process';\n\nconst waitUntilDefaultTimeout = 2000;\nconst waitUntilDefaultInterval = 500;\n\nexport async function waitUntil<T>(fn: () => Promise<T>, options: WaitUntilOptions): Promise<T | undefined> {\n  const opt = {\n    timeout: waitUntilDefaultTimeout,\n    interval: waitUntilDefaultInterval,\n    truthy: true,\n    backoff: 1,\n    retryOnFail: false,\n    ...options,\n  };\n\n  let interval = opt.interval;\n  let lastError: Error | undefined;\n  let elapsed: number = 0;\n  let remaining = opt.timeout;\n\n  for (let i = 0; true; i++) {\n    const start: number = Date.now();\n    let result: T;\n\n    try {\n      // Needed in case a caller uses a 0 timeout (function is only called once)\n      if (remaining > 0) {\n        result = await Promise.race([fn(), new Promise<T>((r: any) => setTimeout(r, remaining))]);\n      } else {\n        result = await fn();\n      }\n\n      if (opt.retryOnFail || (opt.truthy && result) || (!opt.truthy && result !== undefined)) {\n        return result;\n      }\n    } catch (e) {\n      // console.log('e', e);\n      if (!opt.retryOnFail) {\n        throw e;\n      }\n\n      // Unlikely to hit this, but exists for typing\n      if (!(e instanceof Error)) {\n        throw e;\n      }\n\n      lastError = e;\n    }\n\n    // Ensures that we never overrun the timeout\n    remaining -= Date.now() - start;\n\n    // If the sleep will exceed the timeout, abort early\n    if (elapsed + interval >= remaining) {\n      if (!opt.retryOnFail) {\n        return undefined;\n      }\n      throw lastError;\n    }\n\n    // when testing, this avoids the need to progress the stubbed clock\n    if (interval > 0) {\n      await sleep(interval);\n    }\n\n    elapsed += interval;\n    interval = interval * opt.backoff;\n  }\n}\n\n/**\n * Sleeps for the specified duration in milliseconds. Note that a duration of 0 will always wait 1 event loop.\n *\n * Attempts to use the extension-scoped `setTimeout` if it exists, otherwise will fallback to the global scheduler.\n */\nexport function sleep(duration: number = 0): Promise<void> {\n  const schedule = setTimeout;\n  return new Promise((r) => schedule(r, Math.max(duration, 0)));\n}\n","import * as proc from 'child_process';\nimport * as crossSpawn from 'cross-spawn';\n\nimport { ChildProcessTracker } from './ChildProcessTracker';\nimport { waitUntil } from './TimeoutUtils';\nimport {\n  ChildProcessResult,\n  ChildProcessOptions,\n  ChildProcessRunOptions,\n  RunParameterContext,\n} from './interface/Process';\n\nconst eof = Symbol('EOF');\nconst COMPLETE_CODE = 0;\n\nexport class ChildProcess {\n  static #runningProcesses = new ChildProcessTracker();\n  static stopTimeout = 3000;\n  #childProcess: proc.ChildProcess | undefined;\n  #processErrors: Error[] = [];\n  #processResult: ChildProcessResult | undefined;\n\n  /** Collects stdout data if the process was started with `collect=true`. */\n  #stdoutChunks: string[] = [];\n  /** Collects stderr data if the process was started with `collect=true`. */\n  #stderrChunks: string[] = [];\n\n  #command: string;\n  #args: any[];\n  #baseOptions: ChildProcessOptions;\n  #options: any;\n\n  #makeResult(code: number, signal?: NodeJS.Signals): ChildProcessResult {\n    return {\n      exitCode: code,\n      stdout: this.#stdoutChunks.join('').trim(),\n      stderr: this.#stderrChunks.join('').trim(),\n      error: this.#processErrors[0], // Only use the first since that one usually cascades.\n      signal,\n    };\n  }\n\n  public constructor(command: string, args: any[] = [], baseOptions: ChildProcessOptions = {}) {\n    this.#command = command;\n    this.#args = args;\n    this.#baseOptions = baseOptions;\n  }\n  public static async run(\n    command: string,\n    args: string[] = [],\n    options?: ChildProcessOptions,\n  ): Promise<ChildProcessResult> {\n    return await new ChildProcess(command, args, options).run();\n  }\n\n  public async restart(retryCount: number) {\n    console.log('Restarting....');\n    retryCount > 1 ? this.#args.splice(-1, 1, retryCount) : this.#args.push(retryCount);\n\n    await new ChildProcess(this.#command, this.#args, this.#baseOptions).run();\n  }\n\n  public async run(params: ChildProcessRunOptions = {}): Promise<ChildProcessResult> {\n    if (this.#childProcess) {\n      throw new Error('process already started');\n    }\n\n    const options = this.#options ?? {\n      collect: true,\n      waitForStreams: true,\n      ...this.#baseOptions,\n      ...params,\n      spawnOptions: { ...this.#baseOptions.spawnOptions, ...params.spawnOptions },\n    };\n    this.#options = options;\n\n    const { rejectOnError, rejectOnErrorCode } = options;\n    const args = this.#args.concat(options.extraArgs ?? []);\n    // console.info(`Command: ${this.toString(options.logging === 'noparams')}`);\n\n    const cleanup = () => {\n      this.#childProcess?.stdout?.removeAllListeners();\n      this.#childProcess?.stderr?.removeAllListeners();\n    };\n\n    return new Promise<ChildProcessResult>((resolve, reject) => {\n      const errorHandler = (error: Error, force = options.useForceStop) => {\n        this.#processErrors.push(error);\n        if (!this.stopped) {\n          this.stop(force);\n        }\n        if (rejectOnError) {\n          if (typeof rejectOnError === 'function') {\n            reject(rejectOnError(error));\n          } else {\n            reject(error);\n          }\n        }\n      };\n\n      const paramsContext: RunParameterContext = {\n        stop: this.stop.bind(this),\n        send: this.send.bind(this),\n        reportError: (err) => errorHandler(err instanceof Error ? err : new Error(err)),\n      };\n\n      try {\n        this.#childProcess = crossSpawn.spawn(this.#command, this.#args, options.spawnOptions);\n        this.#registerLifecycleListeners(this.#childProcess);\n      } catch (err) {\n        return reject(err);\n      }\n\n      this.#childProcess?.on('error', errorHandler);\n      this.#childProcess?.stdout?.on('error', errorHandler);\n      this.#childProcess?.stderr?.on('error', errorHandler);\n\n      this.#childProcess?.stdout?.on('data', (data: { toString(): string }) => {\n        if (options.collect) {\n          this.#stdoutChunks.push(data.toString());\n        }\n\n        options.onStdout?.(data.toString(), paramsContext);\n      });\n\n      this.#childProcess?.stderr?.on('data', (data: { toString(): string }) => {\n        if (options.collect) {\n          this.#stderrChunks.push(data.toString());\n        }\n\n        options.onStderr?.(data.toString(), paramsContext);\n      });\n\n      this.#childProcess?.once('close', (code, signal) => {\n        this.#processResult = this.#makeResult(code ?? -1, signal ?? undefined);\n        console.log('this.#processResult', this.#processResult);\n        resolve(this.#processResult);\n      });\n\n      this.#childProcess?.once('exit', (code, signal) => {\n        this.#processResult = this.#makeResult(\n          typeof code === 'number' ? code : -1,\n          typeof signal === 'string' ? signal : undefined,\n        );\n        if (code === COMPLETE_CODE) {\n          options.onExit();\n        }\n\n        if (code && rejectOnErrorCode) {\n          if (typeof rejectOnErrorCode === 'function') {\n            reject(rejectOnErrorCode(code));\n          } else {\n            reject(new Error(`Command exited with non-zero code: ${code}`));\n          }\n        }\n        if (options.waitForStreams === false) {\n          resolve(this.#processResult);\n        }\n      });\n    }).finally(() => cleanup());\n  }\n\n  public result(): ChildProcessResult | undefined {\n    return this.#processResult;\n  }\n\n  public pid(): number {\n    return this.#childProcess?.pid ?? -1;\n  }\n\n  public exitCode(): number {\n    return this.#childProcess?.exitCode ?? -1;\n  }\n\n  public pause() {\n    // Windows does not support SIGSTOP and SIGCONT,\n    this.stop(false, 'SIGSTOP');\n  }\n\n  public resume() {\n    this.stop(false, 'SIGCONT');\n  }\n\n  public stop(force: boolean = false, signal?: NodeJS.Signals): void {\n    const child = this.#childProcess;\n    if (!child || child.stdin?.destroyed) {\n      return;\n    }\n    const command = this.#command;\n    const pid = this.pid();\n\n    if (!this.stopped) {\n      child.kill(signal);\n\n      if (force === true) {\n        waitUntil(async () => this.stopped, { timeout: ChildProcess.stopTimeout, interval: 50, truthy: true })\n          .then((stopped) => {\n            if (!stopped) {\n              child.kill('SIGKILL');\n            }\n          })\n          .catch((e: any) => {\n            // console.log(`stop(): SIGKILL failed: pid=${pid} command=${command}`);\n          });\n      }\n    } else {\n      throw new Error('Attempting to kill a process that has already been killed');\n    }\n  }\n\n  #registerLifecycleListeners(process: proc.ChildProcess): void {\n    const pid = process.pid;\n    if (pid === undefined) {\n      return;\n    }\n    ChildProcess.#runningProcesses.add(this);\n  }\n\n  public async send(input: string | Buffer | typeof eof) {\n    if (this.#childProcess === undefined) {\n      throw new Error('Cannot write to non-existent process');\n    }\n\n    const stdin = this.#childProcess.stdin;\n    if (!stdin) {\n      throw new Error('Cannot write to non-existent stdin');\n    }\n\n    if (input === eof) {\n      return new Promise<void>((resolve) => stdin.end('', resolve));\n    }\n\n    return new Promise<void>((resolve, reject) => stdin.write(input, (e) => (e ? reject(e) : resolve())));\n  }\n\n  public get stopped(): boolean {\n    if (!this.#childProcess) {\n      return false; // Not started yet.\n    }\n    return !!this.#processResult;\n  }\n\n  public toString(noparams = false): string {\n    const pid = this.pid() > 0 ? `PID ${this.pid()}:` : '(not started)';\n    return `${pid} [${this.#command} ${noparams ? '...' : this.#args.join(' ')}]`;\n  }\n}\n","export class AsyncQueue<T> {\n  private items: T[] = [];\n  private resolves: ((value: IteratorResult<T>) => void)[] = [];\n  private done = false;\n\n  push(item: T) {\n    if (this.resolves.length) {\n      const resolve = this.resolves.shift();\n      resolve?.({ value: item, done: false });\n    } else {\n      this.items.push(item);\n    }\n  }\n\n  close() {\n    this.done = true;\n    while (this.resolves.length) {\n      const resolve = this.resolves.shift();\n      resolve?.({ value: undefined, done: true });\n    }\n  }\n\n  [Symbol.asyncIterator](): AsyncIterator<T> {\n    return {\n      next: () => {\n        if (this.items.length) {\n          return Promise.resolve({ value: this.items.shift()!, done: false });\n        }\n\n        if (this.done) {\n          return Promise.resolve({ value: undefined, done: true });\n        }\n\n        return new Promise<IteratorResult<T>>((resolve) => {\n          this.resolves.push(resolve);\n        });\n      },\n    };\n  }\n}\n","import { ChildProcess } from './ChildProcess';\nimport { AsyncQueue } from './AsyncQueue';\n\nexport default ChildProcess;\nexport { AsyncQueue };\n"]}