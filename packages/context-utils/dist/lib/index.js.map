{"version":3,"sources":["../../src/Path.ts","../../src/File.ts","../../src/Utils.ts"],"names":["path","os","fs","crypto","config","fs2","stats","ignore","nlp","extractor","arch","os2","fs3"],"mappings":"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","file":"index.js","sourcesContent":["import crypto from 'node:crypto';\nimport path from 'path';\nimport * as os from 'os';\nimport * as fs from 'fs';\n\nimport config from '@cs/context-config';\n\nexport const BASE_CONTEXT_PATH = path.join(os.homedir(), '.codespell/context');\n\n/**\n * Get the root directory of the consuming project.\n * Combines user-supplied paths, `process.cwd()`, and `require.main`.\n * @param customRoot Optional user-supplied root directory.\n * @returns The absolute path to the consumer's root directory.\n */\nexport function getConsumerRoot(customRoot?: string) {\n  // If a custom root directory is supplied, use it\n  if (customRoot) {\n    return path.resolve(customRoot);\n  }\n  return 'src';\n}\n\nexport function getRepoMapPath(): string {\n  return path.join(getCodespellGlobalPath(), 'repo_map.txt');\n}\n\nexport function getPathSep() {\n  return path.sep;\n}\n\nexport function getIndexSqlitePath() {\n  return path.join(getIndexFolderPath(), 'index.sqlite');\n}\n\nexport function getLanceDbPath() {\n  return path.join(getIndexFolderPath(), 'lancedb');\n}\n\nexport function getIndexFolderPath() {\n  const indexPath = path.join(getCodespellGlobalPath(), 'index');\n  if (!fs.existsSync(indexPath)) {\n    fs.mkdirSync(indexPath, { recursive: true });\n  }\n  return indexPath;\n}\n\nconst calculateHash = (path: string): string => {\n  const hash = crypto.createHash('sha256');\n  hash.update(path);\n  return hash.digest('hex');\n};\n\nexport function getWorkspaceDir() {\n  return config.getAppConfig()['workspaceDir'];\n}\n\nexport function getRootDir() {\n  return config.getAppConfig()['rootDir'] ?? __dirname;\n}\n\nexport function getBuildPath() {\n  return config.getAppConfig()['buildPath'] ?? '';\n}\n\nexport function getCodespellGlobalPath() {\n  // This is ~/.codespell on mac/linux\n  const workspaceDir = getWorkspaceDir();\n  if (!workspaceDir) {\n    console.error('Workspace directory is undefined.');\n    throw new Error('Please provide workspace directory');\n  }\n\n  const codespellPath = path.join(BASE_CONTEXT_PATH, calculateHash(workspaceDir));\n  if (!fs.existsSync(codespellPath)) {\n    fs.mkdirSync(codespellPath, { recursive: true });\n  }\n  return codespellPath;\n}\n\nexport function getStatsPath() {\n  return path.join(getCodespellGlobalPath(), 'stats.json');\n}\n\nexport async function getLastModified(files: string[]) {\n  const result: Record<string, number> = {};\n\n  await Promise.all(\n    files.map(async (file) => {\n      try {\n        const { mtimeMs } = await fs.statSync(file);\n        result[file] = mtimeMs;\n      } catch (error) {\n        console.error(`Error getting last modified time for ${file}:`, error);\n      }\n    }),\n  );\n\n  return result;\n}\n\nexport function getBasePath(filePath: string) {\n  return path.basename(path.dirname(filePath));\n}\n\nexport function getScriptPath() {\n  const scriptFile = config.getAppConfig().scriptFile;\n  return scriptFile\n    ? path.join(getRootDir(), getBuildPath(), scriptFile)\n    : `${getRootDir()}/node_modules/@cs/context-provider/dist/lib/index.js`;\n}\n","import * as fs from 'fs';\nimport path from 'path';\nimport ignore from 'ignore';\nimport { BASE_CONTEXT_PATH, getBuildPath, getRootDir, getStatsPath } from './Path';\nimport config from '@cs/context-config';\n\nexport async function read(filepath: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    fs.readFile(filepath, 'utf8', (err, contents) => {\n      if (err) {\n        console.log(err);\n        resolve('');\n      }\n      resolve(contents);\n    });\n  });\n}\n\nfunction getAllFiles(dirPath: string, arrayOfFiles: string[] = []): string[] {\n  if (!fs.existsSync(dirPath)) {\n    console.error(`Directory does not exist: ${dirPath}`);\n  }\n\n  const stats = fs.statSync(dirPath);\n  if (!stats.isDirectory()) {\n    console.error(`Path is not a directory: ${dirPath}`);\n  }\n\n  const files = fs.readdirSync(dirPath);\n\n  files.forEach((file) => {\n    const filePath = path.join(dirPath, file);\n    const stats = fs.statSync(filePath);\n\n    if (stats.isDirectory()) {\n      getAllFiles(filePath, arrayOfFiles);\n    } else if (stats.isFile()) {\n      arrayOfFiles.push(filePath);\n    }\n  });\n\n  return arrayOfFiles;\n}\n\nasync function getDefaultIgnoreRules() {\n  const sourcePath = path.join(getRootDir(), getBuildPath(), '/node_modules/@cs/context-utils', '.ignore-rules');\n\n  if (fs.existsSync(sourcePath)) {\n    return await read(sourcePath);\n  }\n\n  return '';\n}\n\nexport function collectAllFiles(paths: string[], rootDir: string, ignoreRules: string): string[] {\n  const allFiles: string[] = [];\n  // const defaultIgnoreRules = await getDefaultIgnoreRules();\n  const defaultIgnoreRules = `# === General ===\n*.log\n*.tmp\n*.bak\n*.swp\n*.swo\n\n# === PHP ===\nvendor/\ncomposer.lock\n\n# === Java ===\n*.class\n*.jar\n*.war\n*.ear\n*.iml\n*.ipr\n*.iws\ntarget/\nout/\nbuild/\n\n# === .NET ===\n[Bb]in/\n[Oo]bj/\n*.exe\n*.dll\n*.pdb\n*.mdb\n*.cache\n*.log\n*.user\n*.suo\n*.userosscache\n*.sln.docstates\n\n# === TypeScript / JavaScript ===\nnode_modules/\ndist/\nout/\nbuild/\n*.tsbuildinfo\npackage-lock*\n\n# === Python ===\n__pycache__/\n*.py[cod]\n*.pyo\n*.pyd\n*.egg\n*.egg-info/\nbuild/\ndist/\n.eggs/\n*.env\n*.venv\nenv/\nvenv/\nsite-packages/\nlib64/\n.Python\n\n# === IDEs ===\n.idea/\n.vscode/\n*.sublime-workspace\n*.sublime-project\n*.DS_Store\n\n# === Other common ===\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\npids/\n*.pid\n*.seed\n*.pid.lock`;\n  const consolidatedIgnoreRules = `${defaultIgnoreRules} ${ignoreRules}`.trim();\n\n  paths.forEach((currentPath) => {\n    if (!fs.existsSync(currentPath)) {\n      console.error(`Path does not exist: ${currentPath}`);\n      return;\n    }\n\n    const stats = fs.statSync(currentPath);\n    if (stats.isFile()) {\n      allFiles.push(currentPath);\n    } else if (stats.isDirectory()) {\n      allFiles.push(...getAllFiles(currentPath));\n    } else {\n      console.error(`Path is neither a file nor a directory: ${currentPath}`);\n    }\n  });\n\n  return getAllowedFiles(allFiles, rootDir, consolidatedIgnoreRules);\n}\n\nfunction getAllowedFiles(fileList: string[], rootDir: string, ignoreRules: string): string[] {\n  try {\n    const globalIg = ignore().add(ignoreRules.replace(/\\//g, '/**/'));\n    const dirPath = getDirectoryPathTillFolder(fileList[0], rootDir);\n    return fileList.filter((file) => {\n      try {\n        const relativePathToGitignore = path.relative(dirPath, file).replace(/\\\\/g, '/');\n        return !globalIg.ignores(relativePathToGitignore);\n      } catch (error) {\n        console.error('Error processing file:', file, error);\n        return false;\n      }\n    });\n  } catch (error) {\n    console.error('Error processing ignore files:', error);\n    return [];\n  }\n}\n\n/**\n * Helper function to find the directory path up to a specific folder.\n *\n * @param {string} filePath - Full path of the file.\n * @param {string} folderName - Target folder name to locate.\n * @returns {string} - Directory path up to the folder.\n */\nfunction getDirectoryPathTillFolder(filePath: string, folderName: string): string {\n  let currentDir = path.dirname(filePath);\n\n  while (currentDir && currentDir !== path.parse(currentDir).root) {\n    if (path.basename(currentDir) === folderName) {\n      return currentDir;\n    }\n    currentDir = path.dirname(currentDir);\n  }\n\n  throw new Error(`Folder ${folderName} not found for file ${filePath}`);\n}\n\nexport function getAllAllowedFilesInDir(dirPath: string, rootDir: string, ignoreFilePath: string): string[] {\n  const allFiles = getAllFiles(dirPath);\n  return getAllowedFiles(allFiles, rootDir, ignoreFilePath);\n}\n\nfunction isOlderThan(dateStr: string, days: number) {\n  const timestamp = new Date(dateStr).getTime();\n  const msThreshold = days * 24 * 60 * 60 * 1000;\n  return Date.now() - timestamp > msThreshold;\n}\n\nexport function traverseAndClean(days: number, subpath = '', dir: string = BASE_CONTEXT_PATH): void {\n  if (!fs.existsSync(dir)) {\n    throw new Error(`Directory does not exist: ${dir}`);\n  }\n\n  const entries = fs.readdirSync(dir, { withFileTypes: true });\n  for (const entry of entries) {\n    const fullPath = path.join(dir, entry.name);\n\n    if (entry.isDirectory()) {\n      traverseAndClean(days, subpath, fullPath);\n      continue;\n    }\n\n    if (entry.isFile() && entry.name === 'stats.json') {\n      try {\n        const content = fs.readFileSync(fullPath, 'utf-8');\n        if (!content.trim()) {\n          continue;\n        }\n\n        const data = JSON.parse(content);\n        if (data.lastIndexedAt && isOlderThan(data.lastIndexedAt, days)) {\n          const targetDir = subpath ? path.join(path.dirname(fullPath), subpath) : path.dirname(fullPath);\n\n          if (fs.existsSync(targetDir)) {\n            fs.rmSync(targetDir, { recursive: true, force: true });\n            console.log(`Deleted: ${targetDir}`);\n          } else {\n            console.log(`Skipped: ${targetDir} does not exist`);\n          }\n        }\n      } catch (err) {\n        console.error(`Failed to process ${fullPath}:`, err);\n      }\n    }\n  }\n}\n\nexport function writeStats(data: object) {\n  fs.writeFileSync(getStatsPath(), JSON.stringify(data, null, 2));\n}\n","// @ts-ignore\nimport nlp from 'wink-nlp-utils';\nimport extractor from 'keyword-extractor';\nimport * as fs from 'fs';\nimport * as os from 'os';\n\nconst WORD_SPLIT_CNT = 5;\nexport function getCleanedTrigrams(input: string): string[] {\n  let text = nlp.string.removeExtraSpaces(input);\n  text = nlp.string.stem(text);\n\n  let tokens = nlp.string\n    .tokenize(text, true)\n    .filter((token: any) => token.tag === 'word')\n    .map((token: any) => token.value);\n\n  tokens = nlp.tokens.removeWords(tokens);\n  tokens = nlp.tokens.setOfWords(tokens);\n\n  const cleanedTokens = [...tokens].join(' ');\n  const trigrams = nlp.string.ngram(cleanedTokens, WORD_SPLIT_CNT);\n\n  return trigrams.length ? trigrams : [cleanedTokens];\n}\n\nexport function deduplicateArray<T>(array: T[], equal: (a: T, b: T) => boolean): T[] {\n  const result: T[] = [];\n\n  for (const item of array) {\n    if (!result.some((existingItem) => equal(existingItem, item))) {\n      result.push(item);\n    }\n  }\n\n  return result;\n}\n\nexport function extractKeywords(input: string) {\n  return extractor.extract(input, {\n    language: 'english',\n    remove_digits: true,\n    return_changed_case: true,\n    remove_duplicates: true,\n  });\n}\n\n/**\n * Determines whether the current Linux system has the required CPU features\n * to support LanceDB's native vector indexing binaries.\n *\n * Specifically, LanceDB requires the `avx2` and `fma` CPU flags, which are\n * common on modern x64 processors. This check only applies on x64 Linux systems.\n *\n * @returns {boolean} - `true` if supported or not applicable; `false` if unsupported.\n */\nexport function hasRequiredCpuFeaturesForLanceDb(): boolean {\n  const REQUIRED_CPU_FLAGS = ['avx2', 'fma'] as const;\n\n  const arch = os.arch();\n\n  // Only check for CPU features on 64-bit Linux systems\n  if (arch !== 'x64') {\n    return true;\n  }\n\n  try {\n    const cpuInfo = fs.readFileSync('/proc/cpuinfo', 'utf-8').toLowerCase();\n    const hasAllRequiredFlags = cpuInfo ? REQUIRED_CPU_FLAGS.every((flag) => cpuInfo.includes(flag)) : true;\n\n    if (!hasAllRequiredFlags) {\n      console.log('Vector indexing disabled - Your Linux system lacks required CPU features (AVX2, FMA).');\n    }\n\n    return hasAllRequiredFlags;\n  } catch (error) {\n    // If CPU info cannot be read (e.g., due to restricted permissions), assume compatibility\n    console.log('Could not determine CPU features. Assuming compatibility by default.');\n    return true;\n  }\n}\n\nexport const isJson = (text: string) => {\n  try {\n    JSON.parse(text);\n    return true;\n  } catch (e: any) {\n    return false;\n  }\n};\n\nexport const safeParseJson = (text: string) => {\n  try {\n    return JSON.parse(text);\n  } catch (e: any) {\n    return text;\n  }\n};\n"]}