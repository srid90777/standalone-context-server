{"version":3,"sources":["../../src/index.ts"],"names":["encoding_for_model","encoding"],"mappings":";;;;;AAGA,IAAI,QAA4B,GAAA,IAAA;AAChC,SAAS,iBAAiB,SAAmB,EAAA;AAC3C,EAAA,IAAI,CAAC,QAAU,EAAA;AACb,IAAA,QAAA,GAAWA,2BAAmB,CAAA,SAA0B,CAAK,IAAAA,2BAAA,CAAmB,OAAO,CAAA;AAAA;AAGzF,EAAO,OAAA,QAAA;AACT;AAEA,SAAS,iBAAiB,OAA8B,EAAA;AACtD,EAAI,IAAA,OAAA,CAAQ,SAAS,UAAY,EAAA;AAC/B,IAAO,OAAA,EAAA;AAAA;AAET,EAAM,MAAA,IAAI,MAAM,wBAAwB,CAAA;AAC1C;AAEO,SAAS,WAAA,CAAY,OAAiB,EAAA,SAAA,GAAY,MAAgB,EAAA;AACvE,EAAMC,MAAAA,SAAAA,GAAW,iBAAiB,SAAS,CAAA;AAC3C,EAAI,IAAA,KAAA,CAAM,OAAQ,CAAA,OAAO,CAAG,EAAA;AAC1B,IAAA,OAAO,OAAQ,CAAA,MAAA,CAAO,CAAC,GAAA,EAAK,IAAS,KAAA;AACnC,MAAA,OAAO,GAAM,GAAA,IAAA,CAAK,IAAS,KAAA,UAAA,GACvB,iBAAiB,IAAI,CAAA,GACrBA,SAAS,CAAA,MAAA,CAAO,KAAK,IAAQ,IAAA,EAAA,EAAI,KAAO,EAAA,EAAE,CAAE,CAAA,MAAA;AAAA,OAC/C,CAAC,CAAA;AAAA,GACC,MAAA;AACL,IAAA,OAAOA,UAAS,MAAO,CAAA,OAAA,IAAW,IAAI,KAAO,EAAA,EAAE,CAAE,CAAA,MAAA;AAAA;AAErD","file":"index.js","sourcesContent":["import { encoding_for_model, Tiktoken, TiktokenModel } from 'tiktoken';\nimport { MessagePart } from '@lib/interface/Token';\n\nlet encoding: Tiktoken | null = null;\nfunction encodingForModel(modelName: string) {\n  if (!encoding) {\n    encoding = encoding_for_model(modelName as TiktokenModel) ?? encoding_for_model('gpt-4');\n  }\n\n  return encoding;\n}\n\nfunction countImageTokens(content: MessagePart): number {\n  if (content.type === 'imageUrl') {\n    return 85;\n  }\n  throw new Error('Non-image content type');\n}\n\nexport function countTokens(content: string, modelName = 'gpt2'): number {\n  const encoding = encodingForModel(modelName);\n  if (Array.isArray(content)) {\n    return content.reduce((acc, part) => {\n      return acc + part.type === 'imageUrl'\n        ? countImageTokens(part)\n        : encoding.encode(part.text ?? '', 'all', []).length;\n    }, 0);\n  } else {\n    return encoding.encode(content ?? '', 'all', []).length;\n  }\n}\n"]}